<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SVG Generator</title>
  </head>
  <body>
    <main id="main"></main>
    <script>
      const ns = 'http://www.w3.org/2000/svg'

      const createCircle = (x, y, r, fill) => {
        const circle = document.createElementNS(ns, 'circle')
        circle.setAttributeNS(null, 'cx', x)
        circle.setAttributeNS(null, 'cy', y)
        circle.setAttributeNS(null, 'r', r)
        circle.setAttributeNS(null, 'fill', fill)

        return circle
      }

      const setPosition = (circle, x = 0, y = 0) => {
        circle.setAttributeNS(null, 'cx', x)
        circle.setAttributeNS(null, 'cy', y)
      }

      const createSvg = () => {
        const svg = document.createElementNS(ns, 'svg')
        svg.setAttributeNS(null, 'viewBox', '0 0 100 100')

        return svg
      }

      const container = document.getElementById('main')
      const svg = createSvg()

      let pt = svg.createSVGPoint()

      // Get point in global SVG space
      function cursorPoint(evt) {
        pt.x = evt.clientX
        pt.y = evt.clientY
        return pt.matrixTransform(svg.getScreenCTM().inverse())
      }

      const c = createCircle(50, 50, 2, 'salmon')
      c.addEventListener('mousedown', () => {
        svg.addEventListener('mousemove', (e) => {
          requestAnimationFrame(() => {
            const loc = cursorPoint(e)
            setPosition(c, loc.x, loc.y)
          })
        })
      })

      // c.addEventListener('mouseup', () => {
      //   c.removeEventListener('mousemove')
      //   c.removeEventListener('mouseup')
      //   c.removeEventListener('mousedown')
      // })

      // c.addEventListener('mouseleave', () => {
      //   c.removeEventListener('mousemove')
      //   c.removeEventListener('mouseup')
      //   c.removeEventListener('mousedown')
      // })

      const step = (t) => {
        // setPosition(c, t / 500, t / 500)
        // requestAnimationFrame(step)
      }

      svg.appendChild(c)
      container.appendChild(svg)

      requestAnimationFrame(step)
    </script>
  </body>
</html>
