---
import { readFile } from 'fs/promises'

import Snippet, { type Props as SnippetProps } from './Snippet.astro'

import Preview from './Preview.astro'
import { CSSPreview, type Props as CSSPreviewProps } from './CSSPreview'

type PreviewSize = 's' | 'm' | 'l'

interface Props extends Omit<SnippetProps, 'lang'> {
  size: PreviewSize
  /**
   * Variables configured as { '--name': config }
   */
  variables?: CSSPreviewProps['variables']
}

const sizes: Record<PreviewSize, [number, number]> = {
  l: [1, 2],
  m: [1, 1],
  s: [2, 1],
}

const { size = 'm', base = './src/snippets', path, variables } = Astro.props

const [main, preview] = sizes[size]

const code = await readFile(`${base}/${path}`, 'utf-8')
---

<Preview main={main} preview={preview}>
  <Snippet {...Astro.props} lang="css" />
  <CSSPreview
    slot="preview"
    client:only="react"
    css={code}
    variables={variables || {}}
  >
    <slot />
  </CSSPreview>
</Preview>
